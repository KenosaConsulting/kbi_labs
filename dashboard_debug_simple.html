<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBI Labs - Debug Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .step { margin: 10px 0; padding: 15px; border-radius: 8px; background: white; border-left: 4px solid #ccc; }
        .step.loading { border-left-color: #f59e0b; }
        .step.success { border-left-color: #10b981; background: #f0fdf4; }
        .step.error { border-left-color: #ef4444; background: #fef2f2; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; margin-top: 10px; }
        button { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #1d4ed8; }
    </style>
</head>
<body>
    <h1>üîß KBI Labs Dashboard Debug</h1>
    <p>This will test each step of dashboard loading to find the exact error.</p>
    
    <div id="step1" class="step loading">
        <strong>Step 1:</strong> Testing basic JavaScript... <span id="step1-result">‚è≥</span>
    </div>
    
    <div id="step2" class="step loading">
        <strong>Step 2:</strong> Loading React libraries... <span id="step2-result">‚è≥</span>
    </div>
    
    <div id="step3" class="step loading">
        <strong>Step 3:</strong> Testing API connectivity... <span id="step3-result">‚è≥</span>
    </div>
    
    <div id="step4" class="step loading">
        <strong>Step 4:</strong> Creating React components... <span id="step4-result">‚è≥</span>
    </div>
    
    <div id="step5" class="step loading">
        <strong>Step 5:</strong> Rendering dashboard... <span id="step5-result">‚è≥</span>
    </div>
    
    <div id="console-log" class="log"></div>
    
    <div style="margin-top: 20px;">
        <button onclick="runTest()">üîÑ Run Test Again</button>
        <button onclick="testAPI()">üß™ Test API Only</button>
        <button onclick="testReactOnly()">‚öõÔ∏è Test React Only</button>
    </div>
    
    <div id="root" style="margin-top: 20px; padding: 20px; background: white; border-radius: 8px;"></div>

    <script>
        let logDiv = document.getElementById('console-log');
        let testStep = 1;
        
        function log(message, type = 'info') {
            console.log(message);
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#64748b';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStep(step, status, message) {
            const stepDiv = document.getElementById(`step${step}`);
            const resultSpan = document.getElementById(`step${step}-result`);
            
            stepDiv.className = `step ${status}`;
            resultSpan.innerHTML = status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚è≥';
            
            if (message) {
                if (!stepDiv.querySelector('.step-detail')) {
                    const detail = document.createElement('div');
                    detail.className = 'step-detail';
                    detail.style.marginTop = '8px';
                    detail.style.fontSize = '14px';
                    detail.style.opacity = '0.8';
                    stepDiv.appendChild(detail);
                }
                stepDiv.querySelector('.step-detail').innerHTML = message;
            }
        }
        
        async function runTest() {
            testStep = 1;
            logDiv.innerHTML = '';
            log('Starting dashboard debug test...', 'info');
            
            // Step 1: Basic JavaScript
            try {
                updateStep(1, 'loading');
                log('Testing basic JavaScript functionality...');
                
                const testVar = "JavaScript works";
                if (typeof testVar === 'string') {
                    updateStep(1, 'success', 'JavaScript engine working correctly');
                    log('‚úÖ JavaScript test passed', 'success');
                } else {
                    throw new Error('JavaScript basic test failed');
                }
                
            } catch (error) {
                updateStep(1, 'error', `JavaScript error: ${error.message}`);
                log(`‚ùå Step 1 failed: ${error.message}`, 'error');
                return;
            }
            
            // Step 2: React Libraries
            try {
                updateStep(2, 'loading');
                log('Checking React library availability...');
                
                await new Promise(resolve => setTimeout(resolve, 1000)); // Wait for libraries
                
                if (typeof React === 'undefined') {
                    throw new Error('React library not loaded');
                }
                if (typeof ReactDOM === 'undefined') {
                    throw new Error('ReactDOM library not loaded');
                }
                if (typeof Babel === 'undefined') {
                    throw new Error('Babel library not loaded');
                }
                
                updateStep(2, 'success', 'React, ReactDOM, and Babel loaded successfully');
                log('‚úÖ All React libraries loaded', 'success');
                
            } catch (error) {
                updateStep(2, 'error', `Library loading error: ${error.message}`);
                log(`‚ùå Step 2 failed: ${error.message}`, 'error');
                return;
            }
            
            // Step 3: API Test
            try {
                updateStep(3, 'loading');
                log('Testing API connectivity...');
                
                const response = await fetch('/api/government-intelligence/health');
                if (!response.ok) {
                    throw new Error(`API returned ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                updateStep(3, 'success', `API healthy: ${data.overall_status}`);
                log('‚úÖ API connectivity test passed', 'success');
                
            } catch (error) {
                updateStep(3, 'error', `API test failed: ${error.message}`);
                log(`‚ùå Step 3 failed: ${error.message}`, 'error');
                return;
            }
            
            // Step 4: React Component Creation
            try {
                updateStep(4, 'loading');
                log('Creating React component...');
                
                const TestComponent = React.createElement('div', {}, 
                    React.createElement('h3', {}, 'üéâ React Component Test'),
                    React.createElement('p', {}, 'If you see this, React is working correctly!'),
                    React.createElement('div', { style: { background: '#f0fdf4', padding: '10px', borderRadius: '4px', marginTop: '10px' } }, 
                        '‚úÖ React component created successfully'
                    )
                );
                
                updateStep(4, 'success', 'React component created without errors');
                log('‚úÖ React component creation test passed', 'success');
                
                // Step 5: Render Component
                updateStep(5, 'loading');
                log('Rendering React component...');
                
                ReactDOM.render(TestComponent, document.getElementById('root'));
                
                updateStep(5, 'success', 'Component rendered to DOM successfully');
                log('‚úÖ React rendering test passed', 'success');
                log('üéâ All tests passed! Dashboard should work now.', 'success');
                
            } catch (error) {
                updateStep(testStep === 4 ? 4 : 5, 'error', `React error: ${error.message}`);
                log(`‚ùå Step ${testStep === 4 ? 4 : 5} failed: ${error.message}`, 'error');
                log(`Stack trace: ${error.stack}`, 'error');
                return;
            }
        }
        
        async function testAPI() {
            log('Testing API endpoints only...', 'info');
            
            const endpoints = [
                '/api/government-intelligence/health',
                '/api/government-intelligence/comprehensive-intelligence',
                '/api/government-intelligence/procurement-opportunities'
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const data = await response.json();
                    log(`‚úÖ ${endpoint}: ${response.status} - ${data.status || 'OK'}`, 'success');
                } catch (error) {
                    log(`‚ùå ${endpoint}: ${error.message}`, 'error');
                }
            }
        }
        
        function testReactOnly() {
            log('Testing React libraries only...', 'info');
            
            try {
                log(`React version: ${React.version || 'Unknown'}`, 'info');
                log(`ReactDOM available: ${typeof ReactDOM !== 'undefined'}`, 'info');
                log(`Babel available: ${typeof Babel !== 'undefined'}`, 'info');
                
                const simpleElement = React.createElement('div', {}, 'Simple React test');
                ReactDOM.render(simpleElement, document.getElementById('root'));
                log('‚úÖ Simple React render successful', 'success');
                
            } catch (error) {
                log(`‚ùå React test failed: ${error.message}`, 'error');
            }
        }
        
        // Auto-run test on page load
        window.addEventListener('load', () => {
            setTimeout(runTest, 500);
        });
        
        // Capture all errors
        window.addEventListener('error', (e) => {
            log(`Global error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            log(`Unhandled promise rejection: ${e.reason}`, 'error');
        });
        
    </script>
    
    <!-- Load React libraries with error handling -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" 
            onload="log('React library loaded successfully', 'success')"
            onerror="log('Failed to load React library', 'error')"></script>
    
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
            onload="log('ReactDOM library loaded successfully', 'success')"
            onerror="log('Failed to load ReactDOM library', 'error')"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"
            onload="log('Babel library loaded successfully', 'success')"
            onerror="log('Failed to load Babel library', 'error')"></script>

</body>
</html>