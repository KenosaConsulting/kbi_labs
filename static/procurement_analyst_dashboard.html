<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBI Labs Procurement Analyst Platform</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e2e8f0;
            padding: 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            padding: 24px;
            border-bottom: 1px solid #e2e8f0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .logo h1 {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-menu {
            padding: 16px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover, .nav-item.active {
            background: #f1f5f9;
            color: #2563eb;
            border-left-color: #2563eb;
        }
        
        .nav-item i {
            width: 16px;
            text-align: center;
        }
        
        .main-content {
            flex: 1;
            overflow: auto;
        }
        
        .header {
            background: white;
            padding: 16px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #374151;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
        }
        
        .content-area {
            padding: 24px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .metric-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }
        
        .metric-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .metric-title {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .metric-change {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .metric-change.positive {
            color: #059669;
        }
        
        .metric-change.negative {
            color: #dc2626;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            margin-bottom: 24px;
        }
        
        .card-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .card-content {
            padding: 24px;
        }
        
        .opportunities-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .opportunities-table th,
        .opportunities-table td {
            text-align: left;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .opportunities-table th {
            font-weight: 600;
            color: #374151;
            background: #f8fafc;
        }
        
        .opportunity-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .opportunity-agency {
            font-size: 0.875rem;
            color: #64748b;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-success {
            background: #dcfce7;
            color: #166534;
        }
        
        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .score {
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .score-high {
            color: #059669;
        }
        
        .score-medium {
            color: #d97706;
        }
        
        .score-low {
            color: #dc2626;
        }
        
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            padding: 20px 24px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .filter-input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Utility functions
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            }).format(amount);
        };

        const formatDate = (dateString) => {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
            });
        };

        const getDaysUntil = (dateString) => {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = date.getTime() - now.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        };

        // API functions
        const api = {
            async fetchOpportunities(filters = {}) {
                const params = new URLSearchParams();
                Object.entries(filters).forEach(([key, value]) => {
                    if (value) params.append(key, value);
                });
                
                const response = await fetch(`/api/opportunities?${params}`);
                if (!response.ok) throw new Error('Failed to fetch opportunities');
                return response.json();
            },

            async fetchDashboardMetrics() {
                const response = await fetch('/api/dashboard/metrics');
                if (!response.ok) throw new Error('Failed to fetch metrics');
                return response.json();
            },

            async fetchAgencies() {
                const response = await fetch('/api/agencies');
                if (!response.ok) throw new Error('Failed to fetch agencies');
                return response.json();
            }
        };

        // Components
        const Sidebar = ({ activeView, setActiveView }) => {
            const menuItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'fas fa-chart-line' },
                { id: 'opportunities', label: 'Opportunities', icon: 'fas fa-bullseye' },
                { id: 'analysis', label: 'AI Analysis', icon: 'fas fa-brain' },
                { id: 'pipeline', label: 'Pipeline', icon: 'fas fa-stream' },
                { id: 'reports', label: 'Reports', icon: 'fas fa-chart-bar' },
                { id: 'settings', label: 'Settings', icon: 'fas fa-cog' },
            ];

            return (
                <div className="sidebar">
                    <div className="logo">
                        <h1><i className="fas fa-target"></i> KBI Procurement</h1>
                    </div>
                    <nav className="nav-menu">
                        {menuItems.map(item => (
                            <div
                                key={item.id}
                                className={`nav-item ${activeView === item.id ? 'active' : ''}`}
                                onClick={() => setActiveView(item.id)}
                            >
                                <i className={item.icon}></i>
                                <span>{item.label}</span>
                            </div>
                        ))}
                    </nav>
                </div>
            );
        };

        const MetricCard = ({ title, value, change, icon, iconColor }) => (
            <div className="metric-card">
                <div className="metric-header">
                    <span className="metric-title">{title}</span>
                    <div className="metric-icon" style={{ backgroundColor: iconColor }}>
                        <i className={icon}></i>
                    </div>
                </div>
                <div className="metric-value">{value}</div>
                {change && (
                    <div className={`metric-change ${change > 0 ? 'positive' : 'negative'}`}>
                        <i className={`fas ${change > 0 ? 'fa-arrow-up' : 'fa-arrow-down'}`}></i>
                        {Math.abs(change)}% from last month
                    </div>
                )}
            </div>
        );

        const OpportunityTable = ({ opportunities, loading }) => {
            if (loading) {
                return (
                    <div className="loading">
                        <i className="fas fa-spinner fa-spin"></i>
                        <p>Loading opportunities...</p>
                    </div>
                );
            }

            if (!opportunities.length) {
                return (
                    <div className="empty-state">
                        <i className="fas fa-search"></i>
                        <h3>No opportunities found</h3>
                        <p>Try adjusting your filters to see more results.</p>
                    </div>
                );
            }

            return (
                <table className="opportunities-table">
                    <thead>
                        <tr>
                            <th>Opportunity</th>
                            <th>Value</th>
                            <th>Deadline</th>
                            <th>Set-Aside</th>
                            <th>AI Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {opportunities.map(opp => (
                            <tr key={opp.id}>
                                <td>
                                    <div className="opportunity-title">{opp.title}</div>
                                    <div className="opportunity-agency">{opp.agency}</div>
                                </td>
                                <td>{opp.estimated_value ? formatCurrency(opp.estimated_value) : 'TBD'}</td>
                                <td>
                                    <div>{formatDate(opp.response_deadline)}</div>
                                    <div style={{ fontSize: '0.75rem', color: '#dc2626' }}>
                                        {getDaysUntil(opp.response_deadline)} days left
                                    </div>
                                </td>
                                <td>
                                    <span className={`badge ${
                                        opp.set_aside_type === 'Small Business' ? 'badge-success' :
                                        opp.set_aside_type === 'Unrestricted' ? 'badge-info' : 'badge-warning'
                                    }`}>
                                        {opp.set_aside_type || 'TBD'}
                                    </span>
                                </td>
                                <td>
                                    {opp.ai_score ? (
                                        <span className={`score ${
                                            opp.ai_score.win_probability > 0.7 ? 'score-high' :
                                            opp.ai_score.win_probability > 0.4 ? 'score-medium' : 'score-low'
                                        }`}>
                                            {Math.round(opp.ai_score.win_probability * 100)}%
                                        </span>
                                    ) : (
                                        <span style={{ color: '#64748b' }}>Not analyzed</span>
                                    )}
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            );
        };

        const Dashboard = ({ metrics }) => (
            <div>
                <div className="metrics-grid">
                    <MetricCard
                        title="Active Opportunities"
                        value={metrics?.total_opportunities || 0}
                        change={12}
                        icon="fas fa-bullseye"
                        iconColor="#2563eb"
                    />
                    <MetricCard
                        title="Pipeline Value"
                        value={formatCurrency(metrics?.pipeline_value || 0)}
                        change={8}
                        icon="fas fa-dollar-sign"
                        iconColor="#059669"
                    />
                    <MetricCard
                        title="Win Rate"
                        value={`${Math.round((metrics?.win_rate || 0) * 100)}%`}
                        change={5}
                        icon="fas fa-trophy"
                        iconColor="#d97706"
                    />
                    <MetricCard
                        title="Upcoming Deadlines"
                        value={metrics?.upcoming_deadlines || 0}
                        icon="fas fa-clock"
                        iconColor="#dc2626"
                    />
                </div>

                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">Market Intelligence</h3>
                    </div>
                    <div className="card-content">
                        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px' }}>
                            <div>
                                <h4>Growing Sectors</h4>
                                <p>Cybersecurity: +23%</p>
                                <p>AI/ML: +45%</p>
                                <p>Cloud Services: +31%</p>
                            </div>
                            <div>
                                <h4>Top Agencies</h4>
                                <p>Department of Defense</p>
                                <p>Department of Homeland Security</p>
                                <p>NASA</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const OpportunitiesView = () => {
            const [opportunities, setOpportunities] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filters, setFilters] = useState({
                agency: '',
                naics_code: '',
                set_aside_type: '',
                min_value: '',
                max_value: ''
            });

            const loadOpportunities = useCallback(async () => {
                setLoading(true);
                try {
                    const data = await api.fetchOpportunities(filters);
                    setOpportunities(data);
                } catch (error) {
                    console.error('Error loading opportunities:', error);
                } finally {
                    setLoading(false);
                }
            }, [filters]);

            useEffect(() => {
                loadOpportunities();
            }, [loadOpportunities]);

            return (
                <div>
                    <div className="filters">
                        <select
                            className="filter-input"
                            value={filters.agency}
                            onChange={(e) => setFilters({...filters, agency: e.target.value})}
                        >
                            <option value="">All Agencies</option>
                            <option value="Department of Defense">Department of Defense</option>
                            <option value="Department of Homeland Security">Department of Homeland Security</option>
                            <option value="NASA">NASA</option>
                        </select>
                        
                        <select
                            className="filter-input"
                            value={filters.set_aside_type}
                            onChange={(e) => setFilters({...filters, set_aside_type: e.target.value})}
                        >
                            <option value="">All Set-Asides</option>
                            <option value="Small Business">Small Business</option>
                            <option value="8(a)">8(a)</option>
                            <option value="WOSB">WOSB</option>
                            <option value="VOSB">VOSB</option>
                        </select>
                        
                        <input
                            type="number"
                            className="filter-input"
                            placeholder="Min Value"
                            value={filters.min_value}
                            onChange={(e) => setFilters({...filters, min_value: e.target.value})}
                        />
                        
                        <button className="btn btn-primary" onClick={loadOpportunities}>
                            <i className="fas fa-search"></i> Search
                        </button>
                    </div>

                    <div className="card">
                        <div className="card-header">
                            <h3 className="card-title">Procurement Opportunities</h3>
                            <div className="header-actions">
                                <button className="btn">
                                    <i className="fas fa-download"></i> Export
                                </button>
                                <button className="btn btn-primary">
                                    <i className="fas fa-plus"></i> Track Opportunity
                                </button>
                            </div>
                        </div>
                        <div className="card-content">
                            <OpportunityTable opportunities={opportunities} loading={loading} />
                        </div>
                    </div>
                </div>
            );
        };

        const AnalysisView = () => (
            <div className="card">
                <div className="card-header">
                    <h3 className="card-title">AI Analysis Engine</h3>
                </div>
                <div className="card-content">
                    <div className="empty-state">
                        <i className="fas fa-brain"></i>
                        <h3>AI Analysis Engine</h3>
                        <p>Advanced AI-powered opportunity analysis and competitive intelligence coming soon.</p>
                        <button className="btn btn-primary" style={{ marginTop: '16px' }}>
                            Request Beta Access
                        </button>
                    </div>
                </div>
            </div>
        );

        const App = () => {
            const [activeView, setActiveView] = useState('dashboard');
            const [metrics, setMetrics] = useState(null);

            useEffect(() => {
                const loadMetrics = async () => {
                    try {
                        const data = await api.fetchDashboardMetrics();
                        setMetrics(data);
                    } catch (error) {
                        console.error('Error loading metrics:', error);
                    }
                };

                loadMetrics();
            }, []);

            const renderContent = () => {
                switch (activeView) {
                    case 'dashboard':
                        return <Dashboard metrics={metrics} />;
                    case 'opportunities':
                        return <OpportunitiesView />;
                    case 'analysis':
                        return <AnalysisView />;
                    default:
                        return (
                            <div className="card">
                                <div className="card-content">
                                    <div className="empty-state">
                                        <i className="fas fa-tools"></i>
                                        <h3>{activeView.charAt(0).toUpperCase() + activeView.slice(1)}</h3>
                                        <p>This feature is under development.</p>
                                    </div>
                                </div>
                            </div>
                        );
                }
            };

            return (
                <div className="app-container">
                    <Sidebar activeView={activeView} setActiveView={setActiveView} />
                    <div className="main-content">
                        <div className="header">
                            <h2>{activeView.charAt(0).toUpperCase() + activeView.slice(1)}</h2>
                            <div className="header-actions">
                                <button className="btn">
                                    <i className="fas fa-bell"></i>
                                </button>
                                <button className="btn">
                                    <i className="fas fa-user"></i> Profile
                                </button>
                            </div>
                        </div>
                        <div className="content-area">
                            {renderContent()}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>